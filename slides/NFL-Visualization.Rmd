---
title: NFL Stats by Division
author: Audrey & Nathan
date: 6/14/19

output:
  slidy_presentation:
    incremental: true
---

# Introduction

> - NFL summary data --> 2009 - 2018

### Focus: "Competitiveness" across the NFL

- Distributions of team success over time
- Differences across divisions (AFC vs NFC)
- Similarities in play styles (pass/run and offense/defense)
- Historical consistency of teams -- how likely are upsets?



***

# Data

- NFL season summaries from 2009 - 2018


### Identifying info:

- team name
- season
- division

### Outcome variables

- wins/losses/ties
- points scored
- points allowed


***

# Data

### Offense / Defense Stats

- offensive points made

- expected points

- defensive points made

- expected defensive points

- broken up two ways:

    - passing vs running plays

    - per attempt vs total across season


***
# Manipulation: Creating New Variables

- more general divisions (removing north/south/east/west)
- win / loss ratio (wins / losses per season)
- win record (double positive, positive, negative) based on win / loss ratio
- avg points scored per game
- avg points allowed per game
- total offensive yards gained
- total defensive yards allowed

***
## Question 1: Divisions

- 2 Major Divisions:
    - National Football Conference (NFC)
    - American Football Conference (AFC)

- Is either division becoming more competitive over time (fewer outlier teams)?
- Does either division appear to have clear dominant teams, or do a variety of teams take the spotlight in different years?

***

## Is either division becoming more competitive over time?




***

## Are there clear dominant teams, or are victories spread out across teams?


```{r, echo = FALSE, message = FALSE}
library(readr)
library(tidyverse)
nfl <- read_csv("nfl_teams_season_summary.csv")
afc <- c("AFC East", "AFC North", "AFC South", "AFC West")
nfc <- c("NFC East", "NFC North", "NFC South", "NFC West")

nfl <- nfl %>% mutate(div_general = ifelse(division %in% afc, "AFC", "NFC"))
nfl <- nfl %>% mutate(WLRatio = wins/losses)
top_teams_by_year <- nfl %>%
  group_by(season, div_general) %>%
  select(season, team, WLRatio) %>% top_n(n=1)

ggplot(top_teams_by_year, aes(x=season, y=WLRatio, fill = team)) +
  geom_bar(stat = "identity", position = "dodge", col = "black") +
  facet_wrap(~div_general) +
  scale_fill_manual(
    breaks = c("ATL", "CAR", "CIN", "DAL", "DEN", "GB", "IND", "KC", "LA", "LAC", "MIN", "NE", "NO", "PHI", "PIT", "SEA"),
    values = c("darkred", "turquoise2", "darkorange2", "gray77", "black", "darkgreen", "darkblue", "red", "goldenrod2", "powderblue", "purple", "blue", "tan", "aquamarine4", "yellow", "chartreuse1"),
    labels = c("Atlanta Falcons", "Carolina Panthers", "Cincinnati Bengals", "Dallas Cowboys", "Denver Broncos", "Green Bay Packers", "Indianapolis Colts", "Kansas City Chiefs", "LA Rams", "LA Chargers", "Minnesota Vikings", "New England Patriots", "New Orleans Saints", "Philadelphia Eagles", "Pittsburgh Steelers", "Seattle Seahawks")) +
  theme(legend.position = "bottom") +
  labs(
    x = NULL,
    y = "Win / Loss Ratio",
    title = "The Best Performing NFL Teams",
    subtitle = "The AFC has more consistent top teams than NFC",
    fill = NULL) +
  scale_x_continuous(
    breaks = c(2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018),
    labels = c("'09", "'10", "'11", "'12", "'13", "'14", "'15", "'16", "'17", "'18"))

```

***

## Takeaways - Divisions

***

## Question 2: Pass/Run


***

```{r, echo = FALSE}
nfl_passrun <- nfl %>%
  mutate(pass = pass_off_total_yards_gained/(pass_off_total_yards_gained + run_off_total_yards_gained), run = run_off_total_yards_gained/(pass_off_total_yards_gained + run_off_total_yards_gained))

#nfl %>% group_by(div_general, team) %>%
#  summarize(mean_WL = mean(WLRatio)) %>%
#  arrange(desc(mean_WL)) %>%
#  head(10)

top10 <- c("NE", "GB", "CAR", "LA", "NO", "LAC", "PIT", "IND", "DEN", "ATL")
nfl_passrun <- nfl_passrun %>% filter(team %in% top10) %>% select(team, season, pass, run)

nfl_passrun %>% gather(key = "type", value = "pct", pass, run) %>%
  group_by(team, type) %>%
  summarize(pct = mean(pct)) %>%
  ggplot(aes(x=team, y=pct, fill = type)) + geom_bar(stat = "identity", position = "fill") + geom_hline(yintercept = 0.331, linetype = "dashed") + xlab(NULL) + ylab("% of Offensive Yards") + labs(title = "What Makes A Top Team? Running or Passing?", subtitle = "The most competitive teams play similarly to each other, but pass more than average", fill = "Play Type")
```


***
## Takeaways - Passing vs Running
***

## Question 3: Offense/Defense
***

```{r, echo = FALSE}
nfl <- nfl %>% mutate(record = ifelse(WLRatio > 2, "Double Positive", ifelse(WLRatio >= 1, "Positive", "Negative")),
                      total_offensive_gained = run_off_total_yards_gained + pass_off_total_yards_gained,
                      total_defensive_allowed = run_def_total_yards_allowed + pass_def_total_yards_allowed)

nfl$record <- factor(nfl$record, levels = c("Double Positive", "Positive", "Negative"))

ggplot(nfl, aes(x=total_defensive_allowed, y=total_offensive_gained, col = record)) + geom_point() + scale_color_manual(breaks = c("Double Positive", "Positive", "Negative"), values = c("green", "gold", "red")) + labs(title = "Offense and Defense Strength", subtitle = "Competitive teams are typically good at both", x = "Total Defensive Yards Allowed in Season", y = "Total Offensive Yards Gained in Season", col = "Win Record")
```


## Takeaways - Offense vs Defense
***


## Question 4: Consistency
***
```{r, echo = FALSE}
ggplot(nfl, aes(x=reorder(team, WLRatio, FUN = median), y = WLRatio, fill = div_general)) + geom_boxplot() + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + xlab(NULL) + ylab("Win / Loss Ratio") + labs(title = "The Top Teams Aren't Always Consistent", subtitle = "The NFL appears very competitive, with decent upset chances", fill = "Division") + geom_hline(yintercept = 1, linetype = "dashed", color = "red")
```

# Conclusions
***
# Limitations
***
# Future Questions
***
